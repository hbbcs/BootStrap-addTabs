/**
 * Website: http://git.oschina.net/hbbcs/bootStrap-addTabs
 *
 * Version : 2.0
 *
 * Created by joe on 2016-2-4.Update 2017-03-14
 */

(function(b){var a={content:"",close:true,monitor:"body",iframe:true,iframeHeight:300,target:".nav-tabs",contextmenu:true,local:{"refreshLabel":"刷新此标签","closeThisLabel":"关闭此标签","closeOtherLabel":"关闭其他标签","closeLeftLabel":"关闭左侧标签","closeRightLabel":"关闭右侧标签"},callback:function(){}};var c;_click=function(e){var d,f;if(typeof e.data("addtab")=="object"){d=e.data("addtab")}else{d=e.data()}if(!d.id&&!d.addtab){d.id=Math.random().toString(36).substring(3,35);e.data("id",d.id)}b.addtabs.add({"target":d.target?d.target:c,"id":d.id?d.id:d.addtab,"title":d.title?d.title:e.html(),"content":a.content?a.content:d.content,"url":d.url,"ajax":d.ajax?true:false})};_createMenu=function(d,e,f){return b("<a>",{"href":"javascript:void(0);","class":"list-group-item","data-right":d}).append(b("<i>",{"class":"glyphicon "+e})).append(f)};_pop=function(l,k,g){b("body").find("#popMenu").remove();var i=k.attr("id")?_createMenu("refresh","glyphicon-refresh",a.local.refreshLabel):"";var f=k.attr("id")?_createMenu("remove","glyphicon-remove",a.local.closeThisLabel):"";var j=k.prev("li").attr("id")?_createMenu("remove-left","glyphicon-chevron-left",a.local.closeLeftLabel):"";var h=k.next("li").attr("id")?_createMenu("remove-right","glyphicon-chevron-right",a.local.closeRightLabel):"";var d=b("<ul>",{"aria-controls":l,"class":"rightMenu list-group",id:"popMenu","aria-url":k.attr("aria-url")}).append(i).append(f).append(_createMenu("remove-circle","glyphicon-remove-circle",a.local.closeOtherLabel)).append(j).append(h);d.css({"top":g.pageY,"left":g.pageX});d.appendTo(b("body")).fadeIn("slow");b("body").on("click","ul.rightMenu a[data-right=refresh]",function(){var m=b(this).parent("ul").attr("aria-controls").substring(4);var e=b(this).parent("ul").attr("aria-url");b.addtabs.add({"id":m,"url":e,"refresh":true})});b("body").on("click","ul.rightMenu a[data-right=remove]",function(){var e=b(this).parent("ul").attr("aria-controls");if(e.substring(0,4)!="tab_"){return}b.addtabs.close({"id":e});b.addtabs.drop()});b("body").on("click","ul.rightMenu a[data-right=remove-circle]",function(){var e=b(this).parent("ul").attr("aria-controls");c.find("li").each(function(){var m=b(this).attr("id");if(m&&m!="tab_"+e){b.addtabs.close({"id":b(this).children("a").attr("aria-controls")})}});b.addtabs.drop()});b("body").on("click","ul.rightMenu a[data-right=remove-left]",function(){var e=b(this).parent("ul").attr("aria-controls");b("#tab_"+e).prevUntil().each(function(){var m=b(this).attr("id");if(m&&m!="tab_"+e){b.addtabs.close({"id":b(this).children("a").attr("aria-controls")})}});b.addtabs.drop()});b("body").on("click","ul.rightMenu a[data-right=remove-right]",function(){var e=b(this).parent("ul").attr("aria-controls");b("#tab_"+e).nextUntil().each(function(){var m=b(this).attr("id");console.log(m);if(m&&m!="tab_"+e){b.addtabs.close({"id":b(this).children("a").attr("aria-controls")})}});b.addtabs.drop()});d.mouseleave(function(){b(this).fadeOut("slow")});b("body").click(function(){d.fadeOut("slow")})};_listen=function(){b(a.monitor).on("click","[data-addtab]",function(){_click(b(this));b.addtabs.drop()});b("body").on("click",".close-tab",function(){var e=b(this).prev("a").attr("aria-controls");b.addtabs.close({"id":e});b.addtabs.drop()});if(a.contextmenu){b("body").on("contextmenu","li[role=presentation]",function(f){var g=b(this).children("a").attr("aria-controls");_pop(g,b(this),f);return false})}var d;b("body").on("dragstart.h5s",".nav-tabs li",function(f){d=b(this)}).on("dragover.h5s dragenter.h5s drop.h5s",".nav-tabs li",function(f){if(d==b(this)){return}b(".dragBack").removeClass("dragBack");b(this).addClass("dragBack");d.insertAfter(b(this))}).on("dragend.h5s",".nav-tabs li",function(){b(".dragBack").removeClass("dragBack")})};b.addtabs=function(d){b.addtabs.set(d);_listen()};b.addtabs.set=function(){if(arguments[0]){if(typeof arguments[0]=="object"){a=b.extend(a,arguments[0]||{})}else{a[arguments[0]]=arguments[1]}}if(typeof a.target=="object"){c=a.target}else{c=b("body").find(a.target).length>0?b(a.target).first():b("body").find(".nav-tabs").first()}};b.addtabs.add=function(g){var i;g.id=g.id?g.id:Math.random().toString(36).substring(3,35);if(typeof g.target=="object"){i=g.target}else{if(typeof g.target=="string"){i=b("body").find(g.target)}else{i=c}}var j="tab_"+g.id;var d=i;console.log(d);var f=d.next(".tab-content");d.find('li[role = "presentation"].active').removeClass("active");f.find('div[role = "tabpanel"].active').removeClass("active");if(d.find("#tab_"+j).length<1){var h=b("<li>",{"role":"presentation","id":"tab_"+j,"aria-url":g.url}).append(b("<a>",{"href":"#"+j,"aria-controls":j,"role":"tab","data-toggle":"tab"}).html(g.title));if(a.close){h.append(b("<i>",{"class":"close-tab glyphicon glyphicon-remove"}))}var e=b("<div>",{"class":"tab-pane","id":j,"role":"tabpanel"});d.append(h);f.append(e)}else{if(!g.refresh){b("#tab_"+j).addClass("active");b("#"+j).addClass("active");return}else{var e=b("#"+j);e.html("")}}if(g.content){e.append(g.content)}else{if(a.iframe&&!g.ajax){e.append(b("<iframe>",{"class":"iframeClass","height":a.iframeHeight,"frameborder":"no","border":"0","src":g.url}))}else{b.get(g.url,function(k){e.append(k)})}}d.find("#tab_"+j).addClass("active");f.find("#"+j).addClass("active")};b.addtabs.close=function(d){if(b("#tab_"+d.id).hasClass("active")){if(b("#tab_"+d.id).parents("li.tabdrop").length>0&&!b("#tab_"+d.id).parents("li.tabdrop").hasClass("hide")){b("#tab_"+d.id).parents(".nav-tabs").find("li").last().addClass("active")}else{b("#tab_"+d.id).prev("li").addClass("active")}b("#"+d.id).prev().addClass("active")}b("#tab_"+d.id).remove();b("#"+d.id).remove();b.addtabs.drop();a.callback()};b.addtabs.closeAll=function(e){if(typeof e=="string"){e=b("body").find(e)}b.each(e.find("li[id]"),function(){var f=b(this).children("a").attr("aria-controls");b("#tab_"+f).remove();b("#"+f).remove()});e.find('li[role = "presentation"]').first().addClass("active");var d=e.find('li[role = "presentation"]').first().children("a").attr("aria-controls");b("#"+d).addClass("active");b.addtabs.drop()};b.addtabs.drop=function(){var d=b("<li>",{"class":"dropdown pull-right hide tabdrop tab-drop"}).append(b("<a>",{"class":"dropdown-toggle","data-toggle":"dropdown","href":"#"}).append(b("<i>",{"class":"glyphicon glyphicon-align-justify"})).append(b("<b>",{"class":"caret"}))).append(b("<ul>",{"class":"dropdown-menu"}));b("body").find(".nav-tabs").each(function(){var e=b(this);if(e.find(".tabdrop").length<1){d.prependTo(e)}else{d=e.find(".tabdrop")}if(e.parent().is(".tabs-below")){d.addClass("dropup")}var f=0;e.append(d.find("li")).find(">li").not(".tabdrop").each(function(){if(this.offsetTop>0||e.width()-b(this).position().left-b(this).width()<83){d.find("ul").prepend(b(this));f++}});if(f>0){d.removeClass("hide");if(d.find(".active").length==1){d.addClass("active")}else{d.removeClass("active")}}else{d.addClass("hide")}})}})(jQuery);$(function(){$.addtabs()});
